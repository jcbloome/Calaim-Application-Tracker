
{
  "entities": {
    "GitCommit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GitCommit",
      "type": "object",
      "description": "Represents a Git commit.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GitCommit entity."
        },
        "hash": {
          "type": "string",
          "description": "The Git commit hash."
        },
        "author": {
          "type": "string",
          "description": "Author of the commit."
        },
        "commitDate": {
          "type": "string",
          "description": "Date and time when the commit was made.",
          "format": "date-time"
        },
        "message": {
          "type": "string",
          "description": "Commit message."
        }
      },
      "required": [
        "id",
        "hash",
        "author",
        "commitDate",
        "message"
      ]
    },
    "ProjectFile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProjectFile",
      "type": "object",
      "description": "Represents a file within the project at a specific commit.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ProjectFile entity."
        },
        "commitId": {
          "type": "string",
          "description": "Reference to GitCommit. (Relationship: GitCommit 1:N ProjectFile)"
        },
        "filePath": {
          "type": "string",
          "description": "The path to the file within the project."
        },
        "content": {
          "type": "string",
          "description": "The content of the file at the specified commit."
        }
      },
      "required": [
        "id",
        "commitId",
        "filePath",
        "content"
      ]
    },
    "RestoreLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RestoreLog",
      "type": "object",
      "description": "Represents a log entry for file restoration attempts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RestoreLog entity."
        },
        "commitId": {
          "type": "string",
          "description": "Reference to GitCommit. (Relationship: GitCommit 1:N RestoreLog)"
        },
        "filePath": {
          "type": "string",
          "description": "The path to the file that was attempted to be restored."
        },
        "restoreDate": {
          "type": "string",
          "description": "The date and time when the restoration was attempted.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the restore operation (e.g., success, failure)."
        },
        "errorMessage": {
          "type": "string",
          "description": "Error message in case of restoration failure (if any)."
        }
      },
      "required": [
        "id",
        "commitId",
        "filePath",
        "restoreDate",
        "status"
      ]
    },
    "StaffTracker": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StaffTracker",
      "description": "Tracks internal staff progress on an application.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "applicationId": {
          "type": "string"
        },
        "userId": {
          "type": "string"
        },
        "healthPlan": {
          "type": "string",
          "enum": [
            "Kaiser",
            "Health Net",
            "Other"
          ]
        },
        "status": {
          "type": "string",
          "description": "The current internal status of the application, e.g., 'Scheduling ISP'."
        },
        "assignedStaffId": {
          "type": "string",
          "description": "The UID of the staff member assigned to this application."
        },
        "nextStep": {
          "type": "string",
          "description": "The next specific action to be taken."
        },
        "nextStepDate": {
          "type": "string",
          "format": "date-time",
          "description": "The due date for the next step."
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "applicationId",
        "userId",
        "healthPlan",
        "status",
        "lastUpdated"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "description": "Represents a single task or to-do item related to an application.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "applicationId": {
          "type": "string"
        },
        "assignedTo": {
          "type": "string",
          "description": "The UID of the staff member this task is assigned to."
        },
        "title": {
          "type": "string",
          "description": "A short title for the task."
        },
        "description": {
          "type": "string",
          "description": "A more detailed description of the task."
        },
        "dueDate": {
          "type": "string",
          "format": "date-time",
          "description": "The date the task is due."
        },
        "isCompleted": {
          "type": "boolean",
          "description": "Whether the task has been completed."
        },
        "completedDate": {
          "type": "string",
          "format": "date-time",
          "description": "The date the task was completed."
        },
        "createdDate": {
          "type": "string",
          "format": "date-time"
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "applicationId",
        "assignedTo",
        "title",
        "dueDate",
        "isCompleted",
        "createdDate",
        "lastUpdated"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/gitCommits/{commitId}",
        "definition": {
          "entityName": "GitCommit",
          "schema": {
            "$ref": "#/backend/entities/GitCommit"
          },
          "description": "Stores information about each Git commit.",
          "params": [
            {
              "name": "commitId",
              "description": "The unique identifier for the GitCommit entity."
            }
          ]
        }
      },
      {
        "path": "/gitCommits/{commitId}/projectFiles/{fileId}",
        "definition": {
          "entityName": "ProjectFile",
          "schema": {
            "$ref": "#/backend/entities/ProjectFile"
          },
          "description": "Stores the state of each project file for a given commit. Includes denormalized 'commitId' for authorization independence.",
          "params": [
            {
              "name": "commitId",
              "description": "The unique identifier for the GitCommit entity."
            },
            {
              "name": "fileId",
              "description": "The unique identifier for the ProjectFile entity."
            }
          ]
        }
      },
      {
        "path": "/gitCommits/{commitId}/restoreLogs/{logId}",
        "definition": {
          "entityName": "RestoreLog",
          "schema": {
            "$ref": "#/backend/entities/RestoreLog"
          },
          "description": "Stores logs of file restoration attempts. Includes denormalized 'commitId' for authorization independence.",
          "params": [
            {
              "name": "commitId",
              "description": "The unique identifier for the GitCommit entity."
            },
            {
              "name": "logId",
              "description": "The unique identifier for the RestoreLog entity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/applications/{applicationId}/staffTrackers/{trackerId}",
        "definition": {
          "entityName": "StaffTracker",
          "schema": {
            "$ref": "#/backend/entities/StaffTracker"
          },
          "description": "Subcollection to track internal staff progress for an application."
        }
      },
      {
        "path": "/users/{userId}/applications/{applicationId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Subcollection for tasks related to a specific application."
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Git State Restorer application's core features: accessing project files by commit hash, replacing file content, and restoring the project state to a specific commit. The structure emphasizes authorization independence and efficient querying.\n\n1.  **Git Commits Collection (`/gitCommits/{commitId}`):** Stores information about each Git commit. No specific authorization concerns beyond ensuring data integrity (e.g., preventing unauthorized modifications). Indexes are important here to filter by commit date and author.\n\n2.  **Project Files Subcollection (`/gitCommits/{commitId}/projectFiles/{fileId}`):** Stores the state of each project file for a given commit. The `commitId` is denormalized into the `ProjectFile` document, enabling direct querying of files for a specific commit without needing to traverse the parent `GitCommit` document (Authorization Independence). This design supports QAPs by enabling secure listing of files associated with a particular commit.\n\n3.  **Restore Logs Subcollection (`/gitCommits/{commitId}/restoreLogs/{logId}`):** Stores logs of file restoration attempts.  Similar to `ProjectFile`, it's a subcollection of `gitCommits`. The design supports QAPs by enabling secure listing of logs associated with a particular commit.\n\n4. **Task Management**: Added a `Task` entity and a corresponding subcollection `/users/{userId}/applications/{applicationId}/tasks/{taskId}`. This allows for granular task tracking per application, which can be assigned to specific staff members. Security rules can be structured to allow admins to manage all tasks, while individual staff members can only manage tasks assigned to them."
  }
}
