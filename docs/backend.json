{
  "entities": {
    "GitCommit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GitCommit",
      "type": "object",
      "description": "Represents a Git commit with its associated metadata.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Git commit (commit hash)."
        },
        "message": {
          "type": "string",
          "description": "Commit message associated with the commit."
        },
        "authorName": {
          "type": "string",
          "description": "Name of the author who made the commit."
        },
        "authorEmail": {
          "type": "string",
          "description": "Email of the author who made the commit.",
          "format": "email"
        },
        "commitDate": {
          "type": "string",
          "description": "Date and time when the commit was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "message",
        "authorName",
        "authorEmail",
        "commitDate"
      ]
    },
    "FileState": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FileState",
      "type": "object",
      "description": "Represents the state of a file at a specific Git commit.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the file state."
        },
        "commitId": {
          "type": "string",
          "description": "Reference to the GitCommit entity. (Relationship: GitCommit 1:N FileState)"
        },
        "filePath": {
          "type": "string",
          "description": "Path to the file within the repository."
        },
        "content": {
          "type": "string",
          "description": "Content of the file at the specific commit."
        }
      },
      "required": [
        "id",
        "commitId",
        "filePath",
        "content"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents the Git project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project."
        },
        "name": {
          "type": "string",
          "description": "The name of the project."
        },
        "description": {
          "type": "string",
          "description": "A description of the project."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores project metadata.  Root document for a project. Each project contains a unique ID.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/commits/{commitId}",
        "definition": {
          "entityName": "GitCommit",
          "schema": {
            "$ref": "#/backend/entities/GitCommit"
          },
          "description": "Stores commit metadata for each project.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "commitId",
              "description": "The unique identifier for the Git commit (commit hash)."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/commits/{commitId}/fileStates/{fileStateId}",
        "definition": {
          "entityName": "FileState",
          "schema": {
            "$ref": "#/backend/entities/FileState"
          },
          "description": "Stores the state of each file at a specific Git commit. Includes denormalized `projectId` for authorization independence.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "commitId",
              "description": "The unique identifier for the Git commit (commit hash)."
            },
            {
              "name": "fileStateId",
              "description": "The unique identifier for the file state."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Git State Restorer application's core features, focusing on secure file access and version restoration based on Git commit hashes. It prioritizes authorization independence to allow for atomic operations and easy debugging. The project files and their states are segregated into collections that reflect their security posture.\n\n*   **Projects Collection:** The root `/projects` collection stores project metadata. Each project has a unique ID.\n*   **Commits Collection:** Each project has a subcollection `/projects/{projectId}/commits` to store commit information. This allows users to look up commit details.\n*   **File States Collection:** Each commit has a subcollection `/projects/{projectId}/commits/{commitId}/fileStates` to store the state of each file at that specific commit.  Denormalization is used here to maintain authorization independence.  Each `fileState` document contains a denormalized `projectId` field that allows rules to enforce ownership.\n\nThis structure enables the required QAPs (queries and permissions) by:\n\n1.  Segregating data based on entity type into distinct collections, simplifying security rules.\n2.  Enabling secure `list` operations for file states within a specific commit, as rules can verify the `projectId` on each `fileState` without needing to access the `project` document.\n\nOwnership and authorization are enforced by the path structure (project ownership) and denormalized `projectId` field on the file states. Timestamps are stored with the commits to provide a record of when the snapshot was taken."
  }
}