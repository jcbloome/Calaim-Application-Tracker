name: ğŸš€ Deploy CalAIM Application

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
      
    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“‹ Install Dependencies
      run: |
        echo "ğŸ”„ Installing dependencies..."
        npm ci
        
    - name: ğŸ” Run Linting
      run: |
        echo "ğŸ” Running ESLint..."
        npm run lint
        
    - name: ğŸ—ï¸ Build Application
      run: |
        echo "ğŸ—ï¸ Building Next.js application..."
        npm run build
        
    - name: ğŸ§ª Run Tests (if available)
      run: |
        echo "ğŸ§ª Running tests..."
        npm test --if-present
        
    - name: âœ… Build Complete
      run: |
        echo "âœ… Build completed successfully!"
        echo "ğŸ“Š Build size information:"
        du -sh .next/ || echo "Build folder not found"
        
    # Uncomment and configure for your deployment service:
    
    # For Vercel:
    # - name: ğŸš€ Deploy to Vercel
    #   uses: amondnet/vercel-action@v25
    #   with:
    #     vercel-token: ${{ secrets.VERCEL_TOKEN }}
    #     vercel-org-id: ${{ secrets.ORG_ID }}
    #     vercel-project-id: ${{ secrets.PROJECT_ID }}
    
    # For Netlify:
    # - name: ğŸš€ Deploy to Netlify
    #   uses: nwtgck/actions-netlify@v2.0
    #   with:
    #     publish-dir: '.next'
    #     production-branch: main
    #   env:
    #     NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
    #     NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        
    - name: ğŸ‰ Deployment Status
      run: |
        echo "ğŸ‰ Deployment workflow completed!"
        echo "ğŸ“… Deployed at: $(date)"
        echo "ğŸ”— Check your live site for updates"

  notify:
    needs: build-and-deploy
    runs-on: ubuntu-latest
    if: always()
    
    steps:
    - name: ğŸ“¢ Notify Status
      run: |
        if [ "${{ needs.build-and-deploy.result }}" == "success" ]; then
          echo "âœ… SUCCESS: CalAIM Application deployed successfully!"
        else
          echo "âŒ FAILED: Deployment failed. Check the logs above."
        fi